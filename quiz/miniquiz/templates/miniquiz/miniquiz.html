{% block context %}
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style type="text/css">
		


    
    
    .option{
        
        width:100%;
        height: 48px;
        background: #F4F6FC;
        text-align: left;
        border-radius: 100px;

        background: #F4F6FC;

        border: 1px solid black;
        padding-left: 15px;
   
        

    }

   
    .o{
        position: relative;
        width: 50%;
        margin: 5px;
 
    }
    .txt{
        position: absolute;
        left: 5%;
        top:28%;
        text-align: center;
        background: #BDBDBD;
        border-radius: 50%;
        width: 8%;
        height: 40%;
        border:1px solid rgba(0, 0, 0, 0.373);
        text-align: center;
        font-size:x-large;
        font-weight: 700;
        color: #131212;
    }
    .option:hover{
        background-color: rgb(1, 0, 6);
        color:#fff;

    }
    .option3{
        position: relative;
    }
    .icons{
        background-repeat: no-repeat;
        background-size: cover;
        position:absolute;
   
        top:25%;

        width:25px;
        right: 5%;
        height:25px;
        text-align: center;
        
    }


#clock {
  padding: 3px;
  display: flex;
  position: relative;
  justify-content: center;
  align-items: center;
  font-weight: bold;

  font-size: 24px;
}


        


	</style>

</head>
<body style="background-color: black;">
	<div class="container mt-4">
        <div class="d-flex justify-content-center row">
            <div class="col-md-6 col-lg-6 ">
                <div class="container">

                      
                    </div>
                <div class="border">
                    <div class="question bg-white p-3 border-bottom">
                        <div class="d-flex flex-row justify-content-between align-items-center mcq">
                            <h4>MCQ Quiz</h4><span>                    
                            <figure id="clock">
                                <div class="mins">0</div>
                                <div>:</div>
                                <div class="secs">00</div>
                                <audio
                                  src="http://soundbible.com/mp3/service-bell_daniel_simion.mp3"
                                ></audio>
                                <svg class="progress-ring" height="120" width="120">
                                  <circle
                                    class="progress-ring__circle"
                                    stroke-width="8"
                                    fill="transparent"
                                    r="50"
                                    cx="60"
                                    cy="60"
                                  />
                                </svg>
                              </figure>
                            </span>
                            </div>
                    </div>
                    <div class="question bg-white p-3 border">
                        <div class="d-flex flex-row align-items-center question-title">
                            
                        </div><div class="ans ml-2">
                            <div id="row">
                                <h3 class="text-danger">Q.</h3>
                                <h5 id="questions" class="mt-1 ml-2 ">Which of the following country has largest population?</h5>
                    
                                <br>
            
                                <div class="rows">
                                    <div class="option1 o" id="a">

            
                                       <input type="button" value="option 1" class="option" id="option1" > 
                                    </div>
                                   <div class="option2 o" id="a">
                      
                                       
            
            
            
                                       <input type="button" value="option 2" class="option" id="option2"  > 
            
                                   </div>
                                    <div class="option3 o" id="a">

                                       
            
            
                                        <input type="button" value="option 3" class="option" id="option3" > 
            
                                    </div>
            
                                    <div class="option4 o" id="a">
                                        <input type="button" value="option 4" class="option" id="option4" > 
                                    </div>
                                </div>
                           </div>
             
            

                        </div>
                    </div>
                    <div class="d-flex flex-row justify-content-between align-items-center p-3 bg-white"><button class="btn btn-primary d-flex align-items-center btn-danger" id="sbtn" type="button" onclick="window.history.go(-1); return false;"><i class="fa fa-angle-left mt-1 mr-1"></i>&nbsp;skip</button</div>
                </div>
            </div>
        </div>
    </div>


    <script>
        var _this=this
        var i=0
        let right=0
        let wrong=0

        var a='{{id}}'
        const questions=document.getElementById("questions")
        const optionInput=document.querySelectorAll('.option')
        const button = document.querySelector('input');
        var form=document.getElementById('submit')
        var box =document.getElementById('row')
        const optionbtn=document.getElementsByTagName('span')
        const right_icon=document.getElementsByClassName('icons')
        const el = document.getElementById("clock");
        var div=document.createElement("div");
        div.classList.add("icons");
  
      


        
        function loadquestion(i){
			{
            question:[]
        	}
            console.log(i)
            if(!(i == 0)){
                console.log("hi")
                myStopFunction()
             

            }
            
			fetch(`http://127.0.0.1:8000/getquestion/${_this.a}`)
			.then((response) => response.json())
			.then((result)=>{
				_this.question=result.data
                var list=_this.question[i]
                // console.log(list.answer[0].answer)
                
                questions.innerHTML=`${i+1}) ${list.question}`
                optionInput[0].value=list.answer[0].answer
                optionInput[1].value=list.answer[1].answer
                optionInput[2].value=list.answer[2].answer
                optionInput[3].value=list.answer[3].answer
                t()
			})

		}    

        optionInput.forEach((input)=>{
            
            
            input.addEventListener('click',function(e){
                // optionbtn.style.backgroundColor="red"
                var ans=input.value
                const answers=question[i].answer

                
                answers.forEach((inputs)=>{  
                        
                    if(inputs.answer == ans){
                        if(inputs.is_correct == true){
                            
                            input.parentNode.append(div)







                            
                            // icons[] => {
                            //     element.style.backgroundImage="url('http://127.0.0.1:8000/media/assest/cross.png')"
                                
                            // }); 
                            var audio = new Audio("{% static '/miniquiz/audio/right_answer.mp3' %}")

                    
                            audio.play()
                            
                            right_icon[0].style.backgroundImage="url('http://127.0.0.1:8000/media/assest/accept.png')"
                            

                            
                            
                            
                            right=right+1
                        }
                        else{

                            // icons.style.backgroundImage="url('http://127.0.0.1:8000/media/assest/cross.png')"
                            input.parentNode.append(div)
                            var audio = new Audio("{% static '/miniquiz/audio/wrong_answer.mp3' %}")

                            audio.play()
                            right_icon[0].style.backgroundImage="url('http://127.0.0.1:8000/media/assest/cross.png')"
                            wrong=wrong+1
                        }
                        i=i+1

                        if(question.length>i){
                            setTimeout(loadquestion, 1000,i);
                            
                        }
                        else{
                            myStopFunction();
                            setTimeout(onfinish, 1000);
                        }
                        
                        

                    }
                })
                
            })

        })
        function onfinish(){
            
            finalQuizpage=`
                            <center>
                            <div>



                                <div class="final_image">
                                    <img src="{% static '/miniquiz/img/assest/winner.png' %}" />    
                                </div>
                                <div class="content">
                                    <p>Congratulations You made ${right} of ${question.length} </p>
                                </div>
                                <div>
                               
                                    <div style="display:flex;justify-content:space-around;align-item:center;"> 
                                        
                                        
                                        <button  id="sbtn" type="submit" value="Submit"  style="width:150px; height:50px;padding:10px");">submit score</button>
                                        <button type="submit" value="Submit" style="width:150px; height:50px;padding:10px" onclick="location.reload();">Restart</button>
                                    </div>
                                </div
                                </div>
                            <center>
                        `
            box.innerHTML=finalQuizpage
            el.style.display="none"
            function getCookie(name) {
			var cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
	
         
		    
            var csrftoken = getCookie('csrftoken');
            const sbtn=document.getElementById("sbtn")
            sbtn.addEventListener("click",function(e){
                var url=`http://127.0.0.1:8000/getquestion/submitscore`
                var a='{{user}}'
                var score=right*10
                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                const queryStrings =urlParams.get('quizid');
               
                fetch(url,{
                    method:'POST',
                    headers:{
                        'Content-type':'application/json',
                        'X-CSRFToken':csrftoken,
                    },
                    body:JSON.stringify({
                    'score':score,
                    'user':a,
                    'quizid':queryStrings,
                
                    })
                        
                    })
                    .then(function(response){
                        // buildList()
                        // document.getElementById('form').reset()
                        console.log("done")
                        location.replace("http://127.0.0.1:8000/getquestion/thanks")

                    })


                
            })

          

           
         
		
		

         
        }
    


        function t(){
            const circle = document.querySelector(".progress-ring__circle");
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;

            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = circumference;

            function setProgress(percent) {
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            }



            const mindiv = document.querySelector(".mins");
            const secdiv = document.querySelector(".secs");


            localStorage.setItem("btn", "focus");

            let  totalsecs, perc, mins, seconds;

            let btn = localStorage.getItem("btn");

            if (btn === "focus") {
            mins = +localStorage.getItem("focusTime") || 1;
            } else {
            mins = +localStorage.getItem("breakTime") || 1;
            }

            seconds = mins * 60;
            totalsecs = mins * 60;
            setTimeout(decremenT);



            function decremenT() {
                console.log(seconds)
                mindiv.textContent = Math.floor(seconds / 60);
                secdiv.textContent = seconds % 60 > 9 ? seconds % 60 : `0${seconds % 60}`;
                if (circle.classList.contains("danger")) {
                circle.classList.remove("danger");
            }



            if (seconds > 0) {
                perc = Math.ceil(((totalsecs - seconds) / totalsecs) * 100);
                setProgress(perc);
                seconds--;
                initial = window.setTimeout(decremenT, 100);
                if (seconds < 10) {
                circle.classList.add("danger");

               
                
                }
            } else {
                mins = 0;
                seconds = 0;
                // setTimeout(loadquestion, 2000,i=i+1)
                let btn = localStorage.getItem("btn");

                if (btn === "focus") {
                    if(question.length>i){
                        
                        if(question.length==i+1){
                            onfinish()                        }
                        else{
                            setTimeout(loadquestion, 1000,i=i+1);
                        }
                    }
                    localStorage.setItem("btn", "break");

                } else {
                    localStorage.setItem("btn", "focus");
                }

            }

            }


        }
        function myStopFunction() {
            clearTimeout(initial);
        }
        loadquestion(i)
        
       




















        

    </script>
    


</body>
</html>
{% endblock context %}